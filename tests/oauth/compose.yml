version: '3.9'

services:
  oauth:
    # build:
    #   context: docker
    #   dockerfile: Dockerfile.oauth
    image: node:12-alpine
    container_name: oauth
    networks:
      - external
      - internal
    ports:
      - 3002:3002
    working_dir: /app
    volumes:
      - ./src:/app
    entrypoint: ["/app/entrypoint.sh"]
    # entrypoint: ['tail', '-f', '/dev/null']
    environment:
      OAUTH_CLIENT_ID: "UdZH8tDRJFGsLAgPwvHGZKlRoFSRA6ZTkDn6h8P8VTA"
      OAUTH_CLIENT_SECRET: "RpWnhNZnovIHiFEuehqYS7zruiEIs8bcaQWv6GS4E08"
      NPM_CONFIG_PREFIX: ./vendor/node_modules
      PORT: 3002
      # DOORKEEPER_APP_URL: 'https://dev.vasandani.me/'
      DEBUG: "express:*"
    labels:
      caddy: auth.dev.vasandani.me
      caddy.handle_path: /*
      caddy.handle_path.reverse_proxy: "{{ upstreams 3002 }}"
      caddy.tls: internal

volumes:
  cloudbeaver_data:
